##!/bin/bash
#
# Initial Setup for Pentest Pi
# 
# run once, but should be safe to re-run
# 
# Heavily borrowed from https://github.com/secgroundzero/warberry/
#

# List of "Other" tools that we'll install through apt-get
APTTOOLS="nbtscan
python-scapy
tcpdump
nmap
tmux
metasploit-framework
exploitdb
monit
git
curl"

# List of handy tools that we'll be syncing from git into /opt/
GITTOOLS="https://github.com/ChrisTruncer/EyeWitness.git
https://github.com/alobbs/macchanger.git
https://github.com/lgandx/Responder.git
https://github.com/gymzombie/PentestPi.git"


if [ "$(id -u)" != "0" ]; then
  echo "ERROR: Sorry, you are not root. Run this script as root or with sudo."
  exit 1
fi

echo """
  Updating Distro...
  """

apt-get update -y


echo """
  Installing necessary tools...
  """

for each in $APTTOOLS; do
  apt-get install $each -y
done


echo """
  Installing git tools in /opt
  """

for each in $GITTOOLS; do
  git clone $each
done

echo """
  OK, now change your root password: 
  """

passwd root

echo """
  Changing your default SSH Keys
  """
rm /etc/ssh/ssh_host_*
dpkg-reconfigure openssh-server
service ssh restart

echo """
  Disabling IPV6
  """
if grep -q 'net.ipv6.conf.all.disable_ipv6' /etc/sysctl.d/local.conf
  then
    echo 'net.ipv6.conf.all.disable_ipv6 already disabled, moving to next'
    exit
  else
    echo 'Setting net.ipv6.conf.all.disable_ipv6 to blocking mode'
    echo 'net.ipv6.conf.all.disable_ipv6 = 1' >> etc/sysctl.d/local.conf
fi
if grep -q 'net.ipv6.conf.default.disable_ipv6' /etc/sysctl.d/local.conf
  then    
    echo 'net.ipv6.conf.default.disable_ipv6 already disabled, moving to next'
    exit
  else
    echo 'Setting net.ipv6.conf.default.disable_ipv6 to blocking mode'
    echo 'net.ipv6.conf.default.disable_ipv6 = 1' >> etc/sysctl.d/local.conf
fi
if grep -q 'net.ipv6.conf.lo.disable_ipv6' /etc/sysctl.d/local.conf
  then    
    echo 'net.ipv6.conf.lo.disable_ipv6 already disabled, moving to next'
    exit
  else
    echo 'Setting net.ipv6.conf.lo.disable_ipv6 to blocking mode'
    echo 'net.ipv6.conf.lo.disable_ipv6 = 1' >> etc/sysctl.d/local.conf
fi


