#!/bin/bash

# This script is for remote changing of a MAC address to be covert. Intended
# to be called from cron to regularly change MAC and get a new DHCP address
# 
# The goal was to take our hiding to the next level so a curious system analyst wouldn't be able
# to spot this box by watching DHCP. Change the arp, change the IP. 
#
# Unfortunately it was acting buggy and I had an engagement starting, so had to take it offline
# Open to improvements or changes. 

iface=eth0
vendor=10:0b:a9
                                # This is our pool of "host" portion MACs
host="35:f9:ea
26:09:d8
0b:c5:9f
9e:2a:19
5e:49:75
b6:cf:6a
4d:01:ab
bd:4f:b1
71:15:73
67:c6:52
f9:85:09
76:5e:f0"

                                # Randomly select one of the above pool:
randomhost(){
shuf -e -n 1 $host
}

                                # Shutdown and change the MAC:
dhclient -r $iface
ifconfig $iface down
ifconfig $iface hw ether $vendor:`randomhost`


# To be even more sneaky, increase the sleep timer to multiple hours.
# this will make it look like a system has been unplugged, and a new one
# plugged in.

sleep 10s        # (Example: Use "2h" here for two hours)

                                # Bring things back up:
ifconfig $iface up
dhclient
